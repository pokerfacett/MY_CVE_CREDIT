# Background
China Mobile An Lianbao WF-1 router is an AX1800 router based on Qualcomm's five-core processor. It adopts a new generation of 11AX technology, 2.4G and 5G dual-band concurrently, and can provide a wireless rate of 1800M, providing high-speed and stable WiFi coverage

# Description
China Mobile An Lianbao WF-1 router provide web interface /api/zrDm/set_ZRElink which receive parameters by POST request, and the parameter bssaddr,abiaddr,devtoken,devid,elinksync,elink_proc_enable field has a command injection vulnerability, An attacker can use the vulnerability to execute remote commands

# Affect Versions
V1.0.1

# POC
![image](https://user-images.githubusercontent.com/13774458/113555763-05820080-962e-11eb-9366-0f79f83edd7a.png)

problem code is in zrElink.lua which receive params from http request as follow：

![image](https://user-images.githubusercontent.com/13774458/113552167-568ef600-9628-11eb-92e4-cbc308e54726.png)

from post request receive paramters and pass into set_elink:

![image](https://user-images.githubusercontent.com/13774458/113552219-673f6c00-9628-11eb-977b-586c355f7d5e.png)

Do not filter params bssaddr,abiaddr,devtoken,devid,elinksync,elink_proc_enable and directly spliced into the command execute function cause command injection

![image](https://user-images.githubusercontent.com/13774458/113552292-8a6a1b80-9628-11eb-9e29-e2d0f6d9e0b0.png)


result of POC is：

![image](https://user-images.githubusercontent.com/13774458/113555838-1d598480-962e-11eb-9052-239d75cb83b5.png)

# Acknowledgements
repoter :Lewei Qu and Dongxiang Ke

# References
https://www.cnvd.org.cn/flaw/show/CNVD-2021-03520

https://www.ebuy7.com/item/china-mobile-wireless-router-qualcomm-qiki-wifi6-routing-mesh-network-home-5g-dual-frequency-double-gigabit-port-wall-wall-high-speed-%E2%80%8B%E2%80%8Bhigh-power-enhanced-dormitory-students-an-lianbao-wf-1-628692180620

http://iot.10086.cn/?l=en-us
